import{W as G}from"./index-Dv1ntQwP.js";import{d as L,Z as P,i as v,R as w,r,o as d,h as m,w as o,a as h,b as l,e as y,u as c,c as V,aj as R,f as A,F as D,P as p,p as W,g as J}from"./index-MVVa4Kd4.js";import{e as Z,a as H}from"./software-D2V1Z9AX.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./upload-ex8U0d6F.js";const Q=u=>(W("data-v-7e98bcba"),u=u(),J(),u),X=["src"],Y=Q(()=>h("div",{class:"el-upload__tip"},"jpg/png/gif files with a size less than 5M.",-1)),ee={class:"dialog-footer"},te=L({__name:"EditSoftware",props:{softwareTypeOption:{}},emits:["refreshList"],setup(u,{expose:I,emit:k}){const S="/file/upload",U="/",E=k,x=P(),g=v(),n=v(!1),t=w({id:"",url:"",title:"",image:"",desc:"",detail:"",softwareTypeId:""}),T=w({title:[{required:!0,message:"请输入",trigger:"blur"}],url:[{required:!0,message:"请输入",trigger:"blur"}],image:[{required:!0,message:"请上传",trigger:"blur"}],desc:[{required:!0,message:"请输入",trigger:"blur"}],detail:[{required:!0,message:"请输入",trigger:"blur"}],softwareTypeId:[{required:!0,message:"请选择",trigger:"change"}]}),_=()=>{Object.keys(t).forEach(s=>{t[s]=""})},j=s=>{if(["image/jpeg","image/png","image/gif"].includes(s.type)){if(s.size/1024/1024>5)return p.error("图片的大小不要超过 5MB ！"),!1}else return p.error("图片的类型必须是 JPEG PNG GIF ！"),!1;return!0},C=s=>{t.image=s.data},M=async s=>{s&&await s.validate(async e=>{e&&(t.id?(await Z(t),p.success("编辑软件成功")):(await H({...t,id:void 0}),p.success("新增软件成功")),E("refreshList"),n.value=!1)})},q=()=>{_(),n.value=!1};return I({openDialog:s=>{s&&Object.keys(t).forEach(e=>{t[e]=s[e]}),n.value=!0}}),(s,e)=>{const f=r("el-input"),i=r("el-form-item"),B=r("el-icon"),$=r("el-upload"),N=r("el-option"),O=r("el-select"),z=r("el-form"),b=r("el-button"),F=r("el-dialog");return d(),m(F,{modelValue:n.value,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value=a),title:"软件信息",width:"850px","destroy-on-close":"",onClose:e[7]||(e[7]=a=>_())},{footer:o(()=>[h("span",ee,[l(b,{onClick:q},{default:o(()=>[y("取消")]),_:1}),l(b,{type:"primary",onClick:e[5]||(e[5]=a=>M(g.value))},{default:o(()=>[y("确认")]),_:1})])]),default:o(()=>[l(z,{model:t,"label-width":"auto",ref_key:"formRef",ref:g,rules:T},{default:o(()=>[l(i,{label:"软件名称",prop:"title"},{default:o(()=>[l(f,{modelValue:t.title,"onUpdate:modelValue":e[0]||(e[0]=a=>t.title=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(i,{label:"下载地址",prop:"url"},{default:o(()=>[l(f,{modelValue:t.url,"onUpdate:modelValue":e[1]||(e[1]=a=>t.url=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(i,{label:"封面图",prop:"image"},{default:o(()=>[l($,{accept:".jpg,.jpeg,.png,.gif,",class:"avatar-uploader","show-file-list":!1,headers:{authorization:`Bearer ${c(x).token}`},action:S,"before-upload":j,"on-success":C},{tip:o(()=>[Y]),default:o(()=>[t.image?(d(),V("img",{key:0,src:`${c(U)}${t.image}`,class:"avatar"},null,8,X)):(d(),m(B,{key:1,class:"avatar-uploader-icon"},{default:o(()=>[l(c(R))]),_:1}))]),_:1},8,["headers"])]),_:1}),l(i,{label:"描述",prop:"desc"},{default:o(()=>[l(f,{type:"textarea",modelValue:t.desc,"onUpdate:modelValue":e[2]||(e[2]=a=>t.desc=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(i,{label:"详情",prop:"detail"},{default:o(()=>[l(G,{value:t.detail,"onUpdate:value":e[3]||(e[3]=a=>t.detail=a),height:"400px"},null,8,["value"])]),_:1}),l(i,{label:"软件分类",prop:"softwareTypeId"},{default:o(()=>[l(O,{modelValue:t.softwareTypeId,"onUpdate:modelValue":e[4]||(e[4]=a=>t.softwareTypeId=a),placeholder:"请选择"},{default:o(()=>[(d(!0),V(D,null,A(s.softwareTypeOption,a=>(d(),m(N,{label:a.name,value:a.id,key:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}}),ne=K(te,[["__scopeId","data-v-7e98bcba"]]);export{ne as default};
